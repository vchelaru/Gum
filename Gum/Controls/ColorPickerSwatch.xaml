<UserControl
    x:Class="Gum.Controls.ColorPickerSwatch"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:cp="clr-namespace:Gum.Controls"
    xmlns:local="clr-namespace:Gum.Controls"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    <Grid>
        <ToggleButton IsChecked="{Binding IsOpen, ElementName=PickerPopup}">
            <ToggleButton.Template>
                <ControlTemplate>
                    <Border
                        x:Name="Swatch"
                        Width="48"
                        Height="24"
                        BorderBrush="#66000000"
                        BorderThickness="1"
                        CornerRadius="3"
                        Cursor="Hand">
                        <Border.Background>
                            <!--  Use DisplayColor for visual display  -->
                            <SolidColorBrush Color="{Binding DisplayColor, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                        </Border.Background>
                    </Border>
                </ControlTemplate>
            </ToggleButton.Template>
        </ToggleButton>
        <!--  Swatch  -->


        <!--  Popup with your existing ColorPicker  -->
        <Popup
            x:Name="PickerPopup"
            Width="128"
            Height="128"
            AllowsTransparency="True"
            Placement="Bottom"
            PlacementTarget="{Binding ElementName=Swatch}"
            StaysOpen="False">
            <Border
                Padding="8"
                Background="{DynamicResource Frb.Surface01}"
                BorderBrush="{DynamicResource Frb.Brushes.Border}"
                BorderThickness="1"
                CornerRadius="6">
                <!--  Use PickerColor for proper two-way binding with the color picker  -->
                <materialDesign:ColorPicker Color="{Binding PickerColor, RelativeSource={RelativeSource AncestorType=UserControl}, Mode=TwoWay}" />
            </Border>
        </Popup>
    </Grid>
</UserControl>