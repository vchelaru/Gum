# Gum Code Style

* Use nullable method parameters when appropriate: If a method checks for null (e.g., `if (instance == null)` or `instance?.SomeProperty`), the parameter MUST be declared as nullable (e.g., `InstanceSave?` instead of `InstanceSave`). Non-nullable parameters should never have null checks.
* Initialize Lists and strings to non-null values (e.g., `List<string> = new List<string>()`, `string = ""`) to avoid null reference issues. Use nullable types for parameters that can legitimately be null, but prefer non-nullable with default values when possible for simplicity.
* Set initial values in the constructor instead of inline with the declaration, unless the value is a constant. This ensures that all initialization logic is in one place and makes it easier to understand the construction of the object.
* Avoid using singletons, even if a singleton is used elsewhere in the codebase. Instead, use dependency injection or other patterns to manage shared state. If the singleton is used in the codebase, then try to move the .Self call as high as it will go, usually to the plugin level.
* **Always create interfaces for services, managers, and helpers**: When creating any new service, manager, or helper class, MUST create a matching interface (I[ClassName]). Use the interface type in all constructor parameters, fields, and references. This ensures loose coupling, testability, and consistency with existing Gum patterns.
* **Register services in Builder.cs only if used app-wide**: Only register services in Builder.cs (via `services.AddSingleton<>()`) if they are used throughout the application by multiple plugins or core systems. Plugin-specific services should NOT be registered in Builder.cs. Instead, plugins should instantiate their own services directly, injecting any required app-level dependencies from DI into the plugin-specific service constructor. Example: `IUserProjectSettingsManager` is app-wide (registered in Builder), but `TreeViewStateService` is plugin-specific (instantiated in MainTreeViewPlugin).
* Always have if-statements use braces, even for single-line bodies. This improves readability and reduces the chance of bugs when modifying code later.
* Do not use `(not, used)` in lambdas, even if you see it elsewhere in the code. Instead use `(_,_)`.
* **Unit tests: always use explicit types, not `var`**. Every local variable declaration in a unit test method must use the concrete type (e.g., `ComponentSave button = new ComponentSave { ... }`, not `var button = new ComponentSave { ... }`).
* **Unit tests: prefer `async Task` over blocking**. Test methods that call async code must be declared `async Task` and use `await`. Never use `.GetAwaiter().GetResult()`, `.Result`, or `.Wait()` in tests.
