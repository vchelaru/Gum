{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "venv:create",
      "type": "shell",
      "problemMatcher": [],
      "windows": {
        "command": "powershell",
        "args": [
          "-NoProfile", "-ExecutionPolicy", "Bypass",
          "-Command",
          "if(!(Test-Path .venv)){ py -3 -m venv .venv }"
        ]
      },
      "linux": {
        "command": "bash",
        "args": ["-c", "[ -d .venv ] || python3 -m venv .venv"]
      },
      "osx": {
        "command": "bash",
        "args": ["-c", "[ -d .venv ] || python3 -m venv .venv"]
      }
    },

    {
      "label": "pip:upgrade",
      "type": "shell",
      "problemMatcher": [],
      "windows": {
        "command": ".venv\\Scripts\\python.exe",
        "args": ["-m", "pip", "install", "--upgrade", "pip", "setuptools", "wheel"]
      },
      "linux": {
        "command": ".venv/bin/python",
        "args": ["-m", "pip", "install", "--upgrade", "pip", "setuptools", "wheel"]
      },
      "osx": {
        "command": ".venv/bin/python",
        "args": ["-m", "pip", "install", "--upgrade", "pip", "setuptools", "wheel"]
      }
    },

    {
      "label": "pip:install",
      "type": "shell",
      "problemMatcher": [],
      "windows": {
        "command": ".venv\\Scripts\\python.exe",
        "args": ["-m", "pip", "install", "-r", "requirements.txt"]
      },
      "linux": {
        "command": ".venv/bin/python",
        "args": ["-m", "pip", "install", "-r", "requirements.txt"]
      },
      "osx": {
        "command": ".venv/bin/python",
        "args": ["-m", "pip", "install", "-r", "requirements.txt"]
      }
    },

    {
      "label": "build gum dlls",
      "type": "shell",
      "windows": {
        "command": ".venv\\Scripts\\python.exe",
        "args": ["tools\\build_dlls_from_source.py"]
      },
      "linux": {
        "command": ".venv/bin/python",
        "args": ["tools/build_dlls_from_source.py"]
      },
      "osx": {
        "command": ".venv/bin/python",
        "args": ["tools/build_dlls_from_source.py"]
      },
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },

    {
      "label": "gen stubs",
      "type": "shell",
      "problemMatcher": [],
      "windows": {
        "command": ".venv\\Scripts\\python.exe",
        "args": ["tools\\pylance_stubs.py"]
      },
      "linux": {
        "command": ".venv/bin/python",
        "args": ["tools/pylance_stubs.py"]
      },
      "osx": {
        "command": ".venv/bin/python",
        "args": ["tools/pylance_stubs.py"]
      }
    },

    {
      "label": "bootstrap",
      "dependsOn": [
        "venv:create",
        "pip:upgrade",
        "pip:install",
        "build gum dlls",
        "gen stubs"
      ],
      "dependsOrder": "sequence",
      "group": { "kind": "build", "isDefault": true }
    },

    {
      "label": "build gumui package",
      "type": "shell",
      "windows": {
        "command": ".venv\\Scripts\\python.exe",
        "args": ["tools\\build_gumui.py"]
      },
      "linux": {
        "command": ".venv/bin/python",
        "args": ["tools/build_gumui.py"]
      },
      "osx": {
        "command": ".venv/bin/python",
        "args": ["tools/build_gumui.py"]
      },
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    },
    {
      "label": "clean gumui repo",
      "group": { "kind": "build", "isDefault": false },
      "type": "shell",
      "windows": {
        "command": ".venv\\Scripts\\python.exe",
        "args": ["tools\\cleanup_python_repo.py"]
      },
      "linux": {
        "command": ".venv/bin/python",
        "args": ["tools/cleanup_python_repo.py"]
      },
      "osx": {
        "command": ".venv/bin/python",
        "args": ["tools/cleanup_python_repo.py"]
      },
      "options": { "cwd": "${workspaceFolder}" },
      "problemMatcher": []
    }

  ]
}
